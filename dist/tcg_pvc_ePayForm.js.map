{"version":3,"sources":["webpack:///./node_modules/escape-html/index.js","webpack:///./node_modules/@cityofphiladelphia/phila-vue-comps/src/components/ePayForm.vue?b2b4","webpack:///node_modules/@cityofphiladelphia/phila-vue-comps/src/components/ePayForm.vue","webpack:///./node_modules/@cityofphiladelphia/phila-vue-comps/src/components/ePayForm.vue?be68","webpack:///./node_modules/@cityofphiladelphia/phila-vue-comps/src/util/generate-billing-xml.js","webpack:///./node_modules/@cityofphiladelphia/phila-vue-comps/src/components/ePayForm.vue"],"names":["matchHtmlRegExp","module","exports","string","escape","str","match","exec","html","index","lastIndex","length","charCodeAt","substring","BALANCE_PARTS","components_ePayFormvue_type_script_lang_js_","mixins","TopicComponent","[object Object]","parseData","accountNum","this","$store","state","sources","tips","data","totalDue","balances","address","streetAddress","property","zipCode","geocode","properties","zip_code","xmlData","buttonStyle","$props","options","height","width","fontSize","actionAddress","calculateTotalDue","commit","console","log","Object","keys","timestamp","date_fns","Date","xmlString","ownerName","escape_html_default","generate_billing_xml","computed","slots","evaluateSlot","text","class","style","methods","years","reduce","acc","year","calculateTotalForYear","map","part","amount","component","componentNormalizer","_h","$createElement","_c","_self","attrs","action","method","target","name","type","domProps","value","_v","directives","rawName","expression","staticClass","__webpack_exports__"],"mappings":"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","file":"tcg_pvc_ePayForm.js","sourcesContent":["/*!\n * escape-html\n * Copyright(c) 2012-2013 TJ Holowaychuk\n * Copyright(c) 2015 Andreas Lubbe\n * Copyright(c) 2015 Tiancheng \"Timothy\" Gu\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module variables.\n * @private\n */\n\nvar matchHtmlRegExp = /[\"'&<>]/;\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = escapeHtml;\n\n/**\n * Escape special characters in the given string of html.\n *\n * @param  {string} string The string to escape for inserting into HTML\n * @return {string}\n * @public\n */\n\nfunction escapeHtml(string) {\n  var str = '' + string;\n  var match = matchHtmlRegExp.exec(str);\n\n  if (!match) {\n    return str;\n  }\n\n  var escape;\n  var html = '';\n  var index = 0;\n  var lastIndex = 0;\n\n  for (index = match.index; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34: // \"\n        escape = '&quot;';\n        break;\n      case 38: // &\n        escape = '&amp;';\n        break;\n      case 39: // '\n        escape = '&#39;';\n        break;\n      case 60: // <\n        escape = '&lt;';\n        break;\n      case 62: // >\n        escape = '&gt;';\n        break;\n      default:\n        continue;\n    }\n\n    if (lastIndex !== index) {\n      html += str.substring(lastIndex, index);\n    }\n\n    lastIndex = index + 1;\n    html += escape;\n  }\n\n  return lastIndex !== index\n    ? html + str.substring(lastIndex, index)\n    : html;\n}\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('form',{attrs:{\"action\":_vm.actionAddress,\"method\":\"post\",\"target\":\"_blank\"}},[_c('input',{attrs:{\"name\":\"billStmt\",\"type\":\"hidden\"},domProps:{\"value\":_vm.xmlData}}),_vm._v(\" \"),_c('input',{directives:[{name:\"show\",rawName:\"v-show\",value:(this.shouldShowButton),expression:\"this.shouldShowButton\"}],staticClass:\"button external\",style:(_vm.buttonStyle),attrs:{\"type\":\"submit\"},domProps:{\"value\":this.$props.slots.text}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <!-- <form action=\"https://test-secure.phila.gov/PaymentCenter/Gateway1/InitiatePurchase.aspx\" -->\r\n  <form :action=\"actionAddress\"\r\n        method=\"post\"\r\n        target=\"_blank\"\r\n  >\r\n  <input name=\"billStmt\"\r\n         type=\"hidden\"\r\n         :value=\"xmlData\"\r\n  >\r\n  <input type=\"submit\"\r\n         class=\"button external\"\r\n         :value=\"this.$props.slots.text\"\r\n         v-show=\"this.shouldShowButton\"\r\n         :style=\"buttonStyle\"\r\n  >\r\n  </form>\r\n</template>\r\n\r\n<script>\r\n  import TopicComponent from './TopicComponent.vue';\r\n  import generateBillingXml from '../util/generate-billing-xml';\r\n\r\n  const BALANCE_PARTS = [\r\n    'principal',\r\n    'interest',\r\n    'penalty',\r\n    'other',\r\n  ];\r\n\r\n  export default {\r\n    mixins: [TopicComponent],\r\n    data() {\r\n      const data = {\r\n        parseData: {\r\n          'accountNum': this.$store.state.sources.tips.data.data.accountNum,\r\n          'totalDue': '',\r\n          'balances': this.$store.state.sources.tips.data.data,\r\n          'address': {\r\n            'streetAddress':  this.$store.state.sources.tips.data.data.property.address,\r\n            'zipCode': this.$store.state.geocode.data.properties.zip_code,\r\n          }\r\n        },\r\n        xmlData: {},\r\n        buttonStyle: 'height: ' + this.$props.options.height + 'px;\\\r\n         width: ' + this.$props.options.width + 'px;\\\r\n         font-size: ' + this.$props.options.fontSize + 'px;\\\r\n         ',\r\n        actionAddress: this.$props.options.actionAddress || 'https://test-secure.phila.gov/PaymentCenter/Gateway1/InitiatePurchase.aspx'\r\n      }\r\n      return data;\r\n    },\r\n    created() {\r\n      this.parseData.totalDue = this.calculateTotalDue();\r\n      this.$store.commit('setPropertyBalance', this.parseData.totalDue);\r\n      this.xmlData = generateBillingXml(this.parseData);\r\n    },\r\n    computed: {\r\n      message() {\r\n        if (this.$props.slots) {\r\n          return this.evaluateSlot(this.$props.slots.text);\r\n        }\r\n      },\r\n      class() {\r\n        if (this.$props.options) {\r\n          return this.$props.options.class || '';\r\n        }\r\n      },\r\n      style() {\r\n        if (this.$props.options) {\r\n          return this.$props.options.style || '';\r\n        }\r\n      },\r\n      shouldShowButton() {\r\n        if (this.parseData.totalDue > 0) {\r\n          return true;\r\n        } else {\r\n          return false;\r\n        }\r\n      },\r\n    },\r\n    methods: {\r\n      calculateTotalDue() {\r\n        return this.parseData.balances.years.reduce((acc, year) => {\r\n          const yearTotal = this.calculateTotalForYear(year);\r\n          return acc + yearTotal;\r\n        }, 0);\r\n      },\r\n      calculateTotalForYear(year) {\r\n        const amounts = BALANCE_PARTS.map(part => year[part]);\r\n        return amounts.reduce((acc, amount) => acc + amount, 0);\r\n      },\r\n    },\r\n  };\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n","import mod from \"-!../../../../vue-loader/lib/index.js??vue-loader-options!./ePayForm.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../vue-loader/lib/index.js??vue-loader-options!./ePayForm.vue?vue&type=script&lang=js&\"","import { format } from 'date-fns';\r\nimport escapeHtml from 'escape-html';\r\n\r\n/*\r\n  this is a helper fn that accepts a data object containing the following:\r\n\r\n    - accountNum <String>\r\n    - amountDue <Number>\r\n    - owner <String>\r\n    - address <Object>\r\n      - streetAddress <String>\r\n      - city <String>\r\n      - state <String>\r\n      - postalCode <String>\r\n      - country <String>\r\n\r\n  and returns a serialized xml object which the epay gateway can accept for\r\n  initiating a purchase.\r\n\r\n  REVIEW does this need to handle credits?\r\n*/\r\n\r\nexport default function (data) {\r\n  console.log('generate billing xml', data);\r\n\r\n  // if data object is empty, return empty string\r\n  if (Object.keys(data).length < 1) {\r\n    return '';\r\n  }\r\n\r\n  // get the current date/time in iso format with timezone\r\n  let timestamp = format(new Date(), 'YYYY-MM-DDTHH:mm:ssZ');\r\n\r\n  // TODO use a json to xml lib instead of forming this string?\r\n  const xmlString = `<?xml version=\"1.0\" encoding=\"utf-16\"?>\r\n<BillingStatement xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\">\r\n  <ApplicationID>fcd68fd2-e923-4b03-a0e7-a678c2ed612a</ApplicationID>\r\n  <AccountNumber />\r\n  <BillNumber>${data.balances.accountNum}</BillNumber>\r\n  <StatementNumber />\r\n  <BillingDate>${timestamp}</BillingDate>\r\n  <DueDate>${timestamp}</DueDate>\r\n  <TotalDue>${data.totalDue}</TotalDue>\r\n  <DepartMentId>0</DepartMentId>\r\n  <Fund>0</Fund>\r\n  <PaymentDate>0001-01-01T00:00:00</PaymentDate>\r\n  <Quantity>0</Quantity>\r\n  <ItemAmount>0</ItemAmount>\r\n  <TotalAmountdue>0</TotalAmountdue>\r\n  <PartialPaymentFlag>false</PartialPaymentFlag>\r\n  <ReceiptpresentFlag>false</ReceiptpresentFlag>\r\n  <Details>\r\n    <BillingStatementDetail>\r\n      <ItemDate>${timestamp}</ItemDate>\r\n      <ItemDescription>Real Estate Tax</ItemDescription>\r\n      <Charges>${data.totalDue}</Charges>\r\n      <Credits>0</Credits>\r\n    </BillingStatementDetail>\r\n  </Details>\r\n  <Customers>\r\n    <Customer>\r\n      <FirstName>${data.balances.property.ownerName}</FirstName>\r\n      <MiddleName />\r\n      <LastName />\r\n      <BillingAddress>\r\n        <Address>\r\n          <AddressLine1>${data.address.streetAddress}</AddressLine1>\r\n          <City>PHILADELPHIA</City>\r\n          <State>PA</State>\r\n          <PostalCode>${data.address.zipCode}</PostalCode>\r\n          <Country>US</Country>\r\n        </Address>\r\n      </BillingAddress>\r\n    </Customer>\r\n  </Customers>\r\n</BillingStatement>\r\n  `;\r\n\r\n  return escapeHtml(xmlString);\r\n};\r\n","import { render, staticRenderFns } from \"./ePayForm.vue?vue&type=template&id=3c54944d&scoped=true&\"\nimport script from \"./ePayForm.vue?vue&type=script&lang=js&\"\nexport * from \"./ePayForm.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3c54944d\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}